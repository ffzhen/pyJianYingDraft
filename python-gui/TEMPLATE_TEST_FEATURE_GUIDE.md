# 模板测试功能使用指南

## 功能概述

模板测试功能允许用户在创建或编辑模板后立即测试模板效果，通过生成测试视频来验证模板的视觉样式是否符合预期。

## 新增功能

### 1. 模板管理界面测试按钮
- 在"模版管理"标签页的模板列表下方新增"测试模版"按钮
- 选择任意模板后点击该按钮即可进行测试

### 2. 编辑对话框测试按钮
- 在编辑模板的对话框中新增"测试模版"按钮
- 可以在编辑过程中实时测试模板效果

### 3. 多种测试场景
- 系统内置3种不同的测试场景，随机选择：
  - 房产话题：半辈子追房涨跌年轻人安稳何在
  - 科技话题：科技改变生活未来已来
  - 健康话题：健康生活从今天开始

### 4. 完整的测试流程
- 自动创建剪映草稿项目
- 添加数字人视频
- 应用模板样式添加标题
- 应用模板样式添加字幕
- 保存草稿供用户查看

## 使用方法

### 方法一：从模板管理界面测试
1. 打开"模版管理"标签页
2. 在模板列表中选择要测试的模板
3. 点击"测试模版"按钮
4. 确认测试后等待完成
5. 在剪映中打开生成的草稿查看效果

### 方法二：从编辑对话框测试
1. 打开"模版管理"标签页
2. 选择模板后点击"编辑所选"
3. 在编辑对话框中调整模板参数
4. 点击"测试模版"按钮测试当前设置
5. 确认测试后等待完成
6. 在剪映中打开生成的草稿查看效果

## 测试数据说明

### 标题测试
- 每个测试场景都有对应的标题
- 标题会应用模板中定义的标题样式（颜色、字体、字号、缩放等）

### 内容测试
- 内容按句分割作为字幕
- 每句字幕显示3秒
- 字幕会应用模板中定义的字幕样式

### 数字人视频
- 使用预设的数字人视频URL
- 视频作为背景，标题和字幕叠加在上方

## 技术实现

### 核心方法
- `test_selected_template()`: 从模板管理界面测试模板
- `_test_template_from_dialog()`: 从编辑对话框测试模板
- `_prepare_template_test_data()`: 准备测试数据

### 测试流程
1. 验证剪映路径配置
2. 获取并验证模板数据
3. 创建工作流实例
4. 创建草稿项目
5. 添加数字人视频
6. 应用模板样式添加标题
7. 应用模板样式添加字幕
8. 保存草稿项目

### 错误处理
- 剪映路径未配置时提示用户
- 模板数据验证失败时使用默认值
- 视频生成失败时显示错误信息
- 所有操作在后台线程执行，不阻塞UI

## 注意事项

1. **剪映路径配置**：测试前需要先在"配置管理"中设置剪映草稿文件夹路径
2. **模板验证**：系统会自动验证和修正模板数据，确保测试顺利进行
3. **测试文件**：每次测试会创建独立的草稿项目，不会覆盖现有项目
4. **网络依赖**：测试需要下载数字人视频，请确保网络连接正常

## 测试验证

运行测试脚本验证功能：
```bash
cd python-gui
python test_template_feature.py
```

测试脚本会验证：
- 模板测试数据准备
- 模板验证功能
- 无效数据修正
- 多种测试场景
- 随机场景选择

## 更新日志

- 新增模板测试按钮
- 新增编辑对话框测试功能
- 新增多种测试场景
- 新增模板数据验证
- 新增错误处理和用户提示
- 新增测试脚本验证

---

通过模板测试功能，用户可以快速验证模板效果，提高模板创建和调整的效率。


