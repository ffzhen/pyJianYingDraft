# 飞书内容预览功能使用指南

## 功能概述

在飞书异步批量标签页中新增了内容预览功能，允许用户在开始批量处理前先获取并预览飞书数据，确认无误后再开始处理。

## 新增功能

### 1. 获取飞书内容
- **按钮位置**: 飞书异步批量标签页 → 工作流控制区域
- **功能**: 点击"获取飞书内容"按钮从飞书多维表格获取数据
- **数据源**: 使用配置中的`content_table_id`字段指定的表格
- **过滤条件**: 自动应用当前设置的过滤条件（状态过滤、包含记录ID、排除记录ID）

### 2. 内容预览区域
- **位置**: 飞书异步批量标签页 → 飞书内容预览区域
- **显示内容**: 
  - 当前应用的过滤条件
  - 符合条件的记录总数
  - 记录编号
  - 字段名和值（超过100字符会截断显示）
  - 格式化显示，便于查看

### 3. 预览操作按钮
- **清空预览**: 清空预览区域内容
- **确认并开始批量处理**: 显示确认对话框后开始批量处理

### 4. 确认流程
确认对话框会显示：
- 记录总数
- 当前过滤条件（状态过滤、包含记录ID、排除记录ID）
- 用户确认后才会开始批量处理

## 使用流程

1. **配置飞书参数**
   - 在配置管理标签页中设置飞书异步工作流参数
   - 确保`app_token`和`content_table_id`已正确配置

2. **设置过滤条件**
   - 在飞书异步批量标签页中设置过滤条件
   - 状态过滤：指定要处理的任务状态（如"视频草稿生成"）
   - 包含记录ID：只处理指定的记录ID（用逗号分隔）
   - 排除记录ID：排除指定的记录ID（用逗号分隔）

3. **获取并预览内容**
   - 点击"获取飞书内容"按钮
   - 系统会自动应用当前设置的过滤条件
   - 在预览区域查看过滤后的数据
   - 确认数据正确性和数量

4. **开始批量处理**
   - 点击"确认并开始批量处理"按钮
   - 在确认对话框中检查处理参数和记录数量
   - 确认后开始批量处理

## 技术实现

### 新增变量
```python
self.feishu_content_data = []  # 存储飞书内容数据
```

### 新增方法
- `fetch_feishu_content()`: 获取飞书内容（应用过滤条件）
- `display_feishu_content(data)`: 显示内容预览（包含过滤条件信息）
- `clear_feishu_content()`: 清空预览
- `confirm_and_start_batch()`: 确认并开始批量处理
- `build_filter_condition()`: 构建飞书API过滤条件

### 新增UI组件
- `self.feishu_content_text`: 内容预览文本框
- 预览操作按钮区域

## 优势

1. **数据确认**: 用户可以在处理前确认数据正确性
2. **过滤预览**: 预览应用过滤条件后的实际数据，确保过滤条件正确
3. **参数验证**: 确认对话框显示所有过滤条件和记录数量
4. **用户体验**: 避免盲目开始批量处理
5. **错误预防**: 减少因数据问题或过滤条件错误导致的处理失败
6. **精确控制**: 可以精确控制要处理的记录范围

## 注意事项

1. 确保飞书配置正确，特别是`app_token`和`content_table_id`
2. 预览区域会截断过长的字段值（超过100字符）
3. 必须先获取内容才能开始批量处理
4. 确认对话框会显示当前的过滤条件设置
5. 过滤条件会实时应用到数据获取，确保预览的数据就是将要处理的数据
6. 如果过滤条件导致没有数据，会显示相应提示信息
