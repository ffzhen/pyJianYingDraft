# 实时任务列表功能使用指南

## 功能概述

GUI应用现已支持实时显示Python工作流的执行结果，任务列表会每2秒自动更新，显示最新的任务状态、进度和统计信息。

## 主要特性

### 🔄 实时更新
- **自动刷新**: 每2秒自动更新任务列表
- **状态同步**: 实时显示任务状态变化
- **进度跟踪**: 显示每个任务的完成进度
- **统计信息**: 实时更新任务统计

### 📊 任务状态显示
| 状态 | 图标 | 进度 | 说明 |
|------|------|------|------|
| pending | ⏳ 待处理 | 0% | 任务等待提交 |
| submitted | 📤 已提交 | 20% | 已提交到Coze |
| running | 🔄 执行中 | 50% | Coze正在处理 |
| completed | ✅ 已完成 | 80% | Coze处理完成 |
| synthesizing | 🎬 合成中 | 90% | 视频合成中 |
| finished | 🎉 全部完成 | 100% | 全部完成 |
| failed | ❌ 失败 | 0% | 处理失败 |

### 🎯 交互功能
- **双击查看详情**: 双击任务可查看详细信息
- **自动滚动**: 自动滚动到最新任务
- **实时统计**: 显示完成率、运行中任务数、失败任务数

## 使用方法

### 1. 启动实时监控
1. 切换到"飞书异步批量"标签页
2. 点击"开始异步批量处理"
3. 任务列表将自动开始实时更新

### 2. 查看任务状态
- 任务列表会每2秒自动刷新
- 可以看到每个任务的实时状态和进度
- 统计信息会实时更新

### 3. 任务详情查看
- 双击任意任务可查看详细信息
- 包括任务ID、标题、状态、进度、时间等

### 4. 停止监控
- 点击"停止处理"按钮
- 或者等待所有任务完成
- 监控会自动停止

## 界面说明

### 任务列表列说明
- **任务ID**: 任务的唯一标识符（截断显示）
- **标题**: 任务标题（超过20字符会截断）
- **状态**: 带图标的状态显示
- **进度**: 完成百分比
- **开始时间**: 任务开始处理的时间
- **完成时间**: 任务完成的时间

### 统计信息
- **完成率**: 已完成任务占总任务的比例
- **运行中**: 当前正在处理的任务数量
- **失败**: 处理失败的任务数量

## 技术实现

### 核心方法
- `start_task_status_monitor()`: 启动实时监控
- `update_task_list()`: 更新任务列表显示
- `update_task_statistics()`: 更新统计信息
- `auto_scroll_to_latest()`: 自动滚动到最新任务
- `on_task_double_click()`: 处理双击事件

### 更新机制
```python
# 每2秒更新一次
self.task_update_timer = self.root.after(2000, self.schedule_next_update)
```

### 状态计算
```python
def _calculate_task_progress(self, task) -> int:
    if task.status.value == 'pending':
        return 0
    elif task.status.value == 'submitted':
        return 20
    # ... 其他状态
```

## 性能优化

### 更新频率
- 默认每2秒更新一次
- 可根据需要调整更新频率
- 任务完成后自动停止监控

### 内存管理
- 自动清理过期的定时器
- 避免内存泄漏
- 优化列表更新性能

## 故障排除

### 常见问题
1. **任务列表不更新**: 检查是否有运行中的异步任务
2. **状态显示异常**: 确认任务对象结构正确
3. **统计信息错误**: 检查任务状态枚举值

### 调试方法
- 查看控制台日志输出
- 检查任务状态变化
- 验证数据格式正确性

## 测试验证

运行测试脚本验证功能：
```bash
python test_realtime_tasks.py
```

测试内容包括：
- 任务状态显示
- 进度计算
- 统计信息更新
- 状态图标映射

## 更新日志

- ✅ 实现实时任务状态监控
- ✅ 添加任务进度显示
- ✅ 添加统计信息更新
- ✅ 添加任务详情查看
- ✅ 添加自动滚动功能
- ✅ 优化界面显示效果
- ✅ 添加状态图标显示

## 使用示例

### 启动实时监控
```python
# 在GUI中点击"开始异步批量处理"
# 系统会自动启动实时监控
```

### 查看任务状态
```python
# 任务列表会显示类似以下内容：
# task_001 视频制作任务1 ⏳ 待处理 0% - -
# task_002 视频制作任务2 📤 已提交 20% 14:30:15 -
# task_003 视频制作任务3 🔄 执行中 50% 14:30:16 -
```

### 统计信息
```python
# 统计信息会显示类似：
# 任务统计: 2/5 完成 (40.0%) | 运行中: 2 | 失败: 1
```

现在你可以实时监控Python工作流的执行状态，无需手动刷新，所有信息都会自动更新！
