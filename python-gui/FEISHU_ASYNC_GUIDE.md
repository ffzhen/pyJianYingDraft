# 飞书异步批量工作流使用指南

## 功能概述

本GUI应用现已集成飞书异步批量工作流功能，允许用户通过图形界面配置和定时执行 `python workflow/feishu_async_batch_workflow.py --config workflow/feishu_config_template.json` 命令。

## 主要功能

### 1. 配置管理
在"配置管理"标签页中，新增了以下配置项：

#### 飞书异步工作流配置
- **App Token**: 飞书应用的访问令牌
- **内容表ID**: 存储视频任务内容的表格ID
- **账号表ID**: 存储账号信息的表格ID
- **声音表ID**: 存储声音配置的表格ID
- **数字人表ID**: 存储数字人配置的表格ID

#### 并发配置
- **Coze最大并发数**: 同时调用Coze API的最大数量（默认16）
- **视频合成最大并发数**: 同时进行视频合成的最大数量（默认4）
- **轮询间隔**: 检查任务状态的间隔时间，单位秒（默认30）

### 2. 飞书异步批量处理
在"飞书异步批量"标签页中，可以：

#### 过滤条件设置
- **状态过滤**: 指定要处理的任务状态（默认"视频草稿生成"）
- **包含记录ID**: 只处理指定的记录ID（用逗号分隔）
- **排除记录ID**: 排除指定的记录ID（用逗号分隔）

#### 操作控制
- **开始异步批量处理**: 启动批量处理任务
- **停止处理**: 停止当前正在运行的任务
- **查看任务状态**: 查看当前任务的处理状态和进度

#### 实时监控
- **处理进度**: 显示当前处理进度
- **任务列表**: 显示所有任务的详细状态信息

### 3. 定时任务支持
在"定时任务"标签页中，可以创建定时执行的飞书异步批量工作流：

#### 创建定时任务
1. 选择"工作流类型"为"飞书异步批量"
2. 工作流会自动设置为"飞书异步批量工作流"
3. 设置执行时间和重复周期
4. 点击"创建任务"

#### 定时任务管理
- 查看所有定时任务列表
- 启用/禁用定时任务
- 删除不需要的定时任务

## 使用步骤

### 1. 配置设置
1. 打开"配置管理"标签页
2. 填写所有必要的配置信息：
   - 飞书API配置（App ID、App Secret）
   - 飞书异步工作流配置（App Token、各表ID）
   - Coze API配置（Bearer Token、Workflow ID）
   - 剪映配置（草稿文件夹路径）
   - 并发配置（根据需要调整）
3. 点击"保存配置"

### 2. 手动执行
1. 切换到"飞书异步批量"标签页
2. 设置过滤条件（可选）
3. 点击"开始异步批量处理"
4. 监控处理进度和任务状态

### 3. 定时执行
1. 切换到"定时任务"标签页
2. 填写任务名称
3. 选择"工作流类型"为"飞书异步批量"
4. 设置执行时间和重复周期
5. 点击"创建任务"

## 注意事项

1. **配置完整性**: 确保所有必要的配置项都已填写，否则无法启动工作流
2. **网络连接**: 确保网络连接正常，能够访问飞书API和Coze API
3. **资源占用**: 根据系统性能调整并发配置，避免资源过载
4. **任务监控**: 建议定期查看任务状态，确保处理正常
5. **日志查看**: 在"运行日志"标签页中查看详细的执行日志

## 故障排除

### 常见问题
1. **配置错误**: 检查所有配置项是否正确填写
2. **API调用失败**: 检查网络连接和API密钥是否有效
3. **任务卡住**: 可以尝试停止并重新启动任务
4. **权限问题**: 确保飞书应用有足够的权限访问相关表格

### 日志分析
在"运行日志"标签页中查看详细的错误信息，根据错误提示进行相应的处理。

## 技术实现

本功能基于 `workflow/feishu_async_batch_workflow.py` 实现，通过GUI界面封装了命令行参数和配置管理，提供了更友好的用户体验。

主要特性：
- 异步并发处理，提高效率
- 实时状态监控
- 灵活的过滤条件
- 定时任务支持
- 完整的错误处理和日志记录
